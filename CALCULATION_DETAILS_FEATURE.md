# TSBS Analytics 计算详情功能

## 功能概述

TSBS Analytics 在评分显示模式下提供详细的计算过程展示，帮助用户理解性能评分的具体计算逻辑。

## 评分指标

### 导入速度评分
- **评分范围**: 0-100分
- **计算方式**: 基于实际导入速度与基准值的性能比率
- **评分逻辑**: 
  - 性能≥110%基准值：100分
  - 性能90%-110%：线性计算
  - 性能<90%：按比例递减

### 查询性能综合评分
采用四个维度的加权评分：

#### 1. 均值评分 (权重50%)
- **指标**: 查询平均延迟
- **评分方法**: 偏差率评分法
- **公式**: 偏差率≤10%得100分，否则100-(偏差率-10)×10，最低0分

#### 2. 中位数评分 (权重20%)
- **指标**: 查询中位数延迟
- **评分方法**: 偏差率评分法
- **计算逻辑**: 同均值评分

#### 3. 标准差评分 (权重20%)
- **指标**: 查询延迟的标准差
- **评分方法**: 偏差率评分法
- **特殊处理**: 
  - 当测试数据缺少标准差时，系统会从均值变异度估算
  - 如果只有单次测试数据，标准差设为0
  - 基准值为0且实际值为0时，得满分

#### 4. 极差评分 (权重10%)
- **指标**: 查询延迟的极差(最大值-最小值)
- **评分方法**: 偏差率评分法
- **计算逻辑**: 同均值评分

## 数据处理逻辑

### 标准差数据处理 (已修复)
**问题**: 之前版本在某些情况下会显示"缺少标准差数据或基准值，默认为0分"

**修复内容**:
1. **后端聚合逻辑优化**: 即使原始数据缺少标准差，系统也会从均值变异度计算标准差
2. **空值处理**: 当实际标准差为null时，系统将其设置为0.0并正确计算得分
3. **前端显示优化**: 改进了标准差得分的显示逻辑，提供更准确的说明信息
4. **特殊情况处理**: 正确处理基准值为0的情况

### 聚合算法
当存在多次测试结果时，系统采用以下聚合策略：
- **均值**: 所有测试的简单平均
- **中位数**: 中位数的中位数（更保守的估计）
- **标准差**: 从均值计算变异度
- **极差**: 使用所有测试的真实最小值和最大值

## 评分等级

### 综合评分等级
- **95-100分**: 优秀 ✅
- **90-94分**: 良好 ⚠️  
- **<90分**: 需要改进 ❌

### 通过标准
- 综合评分≥90分：**通过**
- 综合评分<90分：**未通过**

## 使用指南

1. **切换到评分模式**: 在"显示模式"下拉框中选择"评分显示"
2. **查看详细计算**: 点击评分列中的"查看详细计算过程"
3. **理解评分含义**: 参考评分等级和通过标准
4. **分析性能问题**: 通过各维度得分识别性能瓶颈

## 基准值配置

支持四种基准值类型：
- **Master基准值**: 仅支持百分比显示
- **Master第二基准值**: 支持评分显示，包含完整四维度评分
- **企业发版基准值**: 支持评分显示
- **开源发版基准值**: 支持评分显示

## 技术说明

### 偏差率计算公式
```
偏差率 = |实际值 - 基准值| / 基准值 × 100%
```

### 综合评分计算公式
```
综合得分 = 均值得分×50% + 中位数得分×20% + 标准差得分×20% + 极差得分×10%
```

## 版本历史

### v1.1 (当前版本)
- ✅ 修复标准差数据缺失时的错误提示
- ✅ 优化标准差计算逻辑
- ✅ 改进前端显示逻辑
- ✅ 增强特殊情况处理

### v1.0
- 基础评分功能
- 四维度综合评分
- 详细计算过程展示 